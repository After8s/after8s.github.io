<!DOCTYPE html>
<html>
  <head>
    <style>
      body {
    font-family: Muli, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
}

.counter {
   background-color: #f5f5f5;
   padding: 10px 0;
   border-radius: 5px;
   line-height: 1 !important;
}
.count-title {
   font-size: 14px;
   font-weight: normal;
   margin-top: 10px;
   margin-bottom: 0;
   text-align: center;
}
.count-text {
   font-size: 16px;
   font-weight: bold;
   margin-top: 10px;
   margin-bottom: 0;
   text-align: left;
}
.fa-2x {
   margin: 0 auto;
   float: none;
   display: table;
   color: #4ad1e5;
}
.row {
   margin-top: 10px;
   margin-bottom: 10px;
}
.slimrow {
   margin: 0 auto !important;
   width: 130px;
}

* {box-sizing: border-box}

/* Style the tab */
.tab {
    float: left;
//    border: 1px solid #ccc;
//    background-color: #f1f1f1;
  
  width: 25%;
    height: 400px;
}

/* Style the buttons inside the tab */
.tab button {
    display: block;
    background-color: inherit;
    color: black;
    padding: 22px 16px;
    width: 100%;
    border: none;
    outline: none;
    text-align: left;
    cursor: pointer;
    transition: 0.3s;
    font-size: 17px;
}

/* Change background color of buttons on hover */
.tab button:hover {
    background-color: #ddd;
}

/* Create an active/current "tab button" class */
.tab button.active {
    background-color: #eee;
}

/* Style the tab content */
.tabcontent {
    float: left;
 //   padding: 0px 12px;
//    border: 1px solid #ccc;
    background-color: #eee;
    width: 75%;
    border-left: none;
    height: 400px;
}
th {
   border:0px !important;
   width: 10% !important;
   }
td {
   border:0px !important;
   width: 45% !important;
   height: 40px !important;
}

.sk-folding-cube {
  margin: 20px auto;
  width: 40px;
  height: 40px;
  position: relative;
  -webkit-transform: rotateZ(45deg);
          transform: rotateZ(45deg);
}

.sk-folding-cube .sk-cube {
  float: left;
  width: 50%;
  height: 50%;
  position: relative;
  -webkit-transform: scale(1.1);
      -ms-transform: scale(1.1);
          transform: scale(1.1); 
}
.sk-folding-cube .sk-cube:before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: #333;
  -webkit-animation: sk-foldCubeAngle 2.4s infinite linear both;
          animation: sk-foldCubeAngle 2.4s infinite linear both;
  -webkit-transform-origin: 100% 100%;
      -ms-transform-origin: 100% 100%;
          transform-origin: 100% 100%;
}
.sk-folding-cube .sk-cube2 {
  -webkit-transform: scale(1.1) rotateZ(90deg);
          transform: scale(1.1) rotateZ(90deg);
}
.sk-folding-cube .sk-cube3 {
  -webkit-transform: scale(1.1) rotateZ(180deg);
          transform: scale(1.1) rotateZ(180deg);
}
.sk-folding-cube .sk-cube4 {
  -webkit-transform: scale(1.1) rotateZ(270deg);
          transform: scale(1.1) rotateZ(270deg);
}
.sk-folding-cube .sk-cube2:before {
  -webkit-animation-delay: 0.3s;
          animation-delay: 0.3s;
}
.sk-folding-cube .sk-cube3:before {
  -webkit-animation-delay: 0.6s;
          animation-delay: 0.6s; 
}
.sk-folding-cube .sk-cube4:before {
  -webkit-animation-delay: 0.9s;
          animation-delay: 0.9s;
}
@-webkit-keyframes sk-foldCubeAngle {
  0%, 10% {
    -webkit-transform: perspective(140px) rotateX(-180deg);
            transform: perspective(140px) rotateX(-180deg);
    opacity: 0; 
  } 25%, 75% {
    -webkit-transform: perspective(140px) rotateX(0deg);
            transform: perspective(140px) rotateX(0deg);
    opacity: 1; 
  } 90%, 100% {
    -webkit-transform: perspective(140px) rotateY(180deg);
            transform: perspective(140px) rotateY(180deg);
    opacity: 0; 
  } 
}

@keyframes sk-foldCubeAngle {
  0%, 10% {
    -webkit-transform: perspective(140px) rotateX(-180deg);
            transform: perspective(140px) rotateX(-180deg);
    opacity: 0; 
  } 25%, 75% {
    -webkit-transform: perspective(140px) rotateX(0deg);
            transform: perspective(140px) rotateX(0deg);
    opacity: 1; 
  } 90%, 100% {
    -webkit-transform: perspective(140px) rotateY(180deg);
            transform: perspective(140px) rotateY(180deg);
    opacity: 0; 
  }
}

.cubelegend {
   margin : 10px auto 0 auto;
   text-align: center;
}
    </style>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    
    <script>
           
          //v4.0.0
          var bungieAPIkey = '0a11942f318647978979f13ad8aa53ee';
           var clan = {};
          clan.memberIds = [];
          clan.memberCount = 0;
          clan.membersFetched = 0;
          clan.memberName = {};
          clan.retryCounter = {};
          clan.unresolvedMemberNames = [];
           var CharStatsDataLocations = {};
                CharStatsDataLocations.pvpKills = 'Response.mergedAllCharacters.results.allPvP.allTime.kills.basic.value';
                CharStatsDataLocations.pvpAssists = 'Response.mergedAllCharacters.results.allPvP.allTime.assists.basic.value';
                CharStatsDataLocations.pvpKD = 'Response.mergedAllCharacters.results.allPvP.allTime.killsDeathsRatio.basic.value';
                CharStatsDataLocations.pvpWon = 'Response.mergedAllCharacters.results.allPvP.allTime.activitiesWon.basic.value';
                CharStatsDataLocations.pvpDeaths = 'Response.mergedAllCharacters.results.allPvP.allTime.deaths.basic.value';
                CharStatsDataLocations.pvpSuicides = 'Response.mergedAllCharacters.results.allPvP.allTime.suicides.basic.value';
                CharStatsDataLocations.pvpSeconds = 'Response.mergedAllCharacters.results.allPvP.allTime.secondsPlayed.basic.value';
                CharStatsDataLocations.pvpWROOMs = 'Response.mergedAllCharacters.results.allPvP.allTime.medalStreakAbsurd.basic.value';
                CharStatsDataLocations.pvpUndefeats = 'Response.mergedAllCharacters.results.allPvP.allTime.medalMatchUndefeated.basic.value';
                CharStatsDataLocations.pvpInvincible = 'Response.mergedAllCharacters.results.allPvP.allTime.medalShowdownUndefeated.basic.value';
                CharStatsDataLocations.pvpComeback = 'Response.mergedAllCharacters.results.allPvP.allTime.medalMatchComeback.basic.value';
                CharStatsDataLocations.pvpDoubles = 'Response.mergedAllCharacters.results.allPvP.allTime.medalMulti2x.basic.value';
                CharStatsDataLocations.pvpLightsOut = 'Response.mergedAllCharacters.results.allPvP.allTime.medalMulti4x.basic.value';
                CharStatsDataLocations.pvpAnnihilation = 'Response.mergedAllCharacters.results.allPvP.allTime.medalMultiEntireTeam.basic.value';
                CharStatsDataLocations.pvpRuthless = 'Response.mergedAllCharacters.results.allPvP.allTime.medalStreak5x.basic.value';
                CharStatsDataLocations.pvpFightMe = 'Response.mergedAllCharacters.results.allPvP.allTime.medalMatchMostDamage.basic.value';
                CharStatsDataLocations.pvpNSFMF = 'Response.mergedAllCharacters.results.allPvP.allTime.medalSuperShutdown.basic.value';
                CharStatsDataLocations.pveKills = 'Response.mergedAllCharacters.results.allPvE.allTime.kills.basic.value';
                CharStatsDataLocations.pveDeaths = 'Response.mergedAllCharacters.results.allPvE.allTime.deaths.basic.value';
                CharStatsDataLocations.pveSuicides = 'Response.mergedAllCharacters.results.allPvE.allTime.suicides.basic.value';
                CharStatsDataLocations.pveOrbs = 'Response.mergedAllCharacters.results.allPvE.allTime.orbsDropped.basic.value';
                CharStatsDataLocations.pveHPE = 'Response.mergedAllCharacters.results.allPvE.allTime.heroicPublicEventsCompleted.basic.value';
                CharStatsDataLocations.pveAdventures = 'Response.mergedAllCharacters.results.allPvE.allTime.adventuresCompleted.basic.value';
                CharStatsDataLocations.pveSeconds = 'Response.mergedAllCharacters.results.allPvE.allTime.secondsPlayed.basic.value';
          
          $(document).ready(function() {
           
            $('#tablink1').click(()=>{
            	openTab('tablink1', 't1');
            });
            $('#tablink2').click(()=>{
            	openTab('tablink2', 't2');
            });
            $('#tablink3').click(()=>{
            	openTab('tablink3', 't3');
            });
            //default
            $('#tablink1').click();
           
              $.ajax({
                //get member infos from our clan
                url: 'https://www.bungie.net/Platform/GroupV2/1801684/Members/',
                headers: {
                   'X-API-KEY': bungieAPIkey
                },
                method: 'GET',
              }).done(
                function(data) {
                   //collect id strings from every clan member
                   if (!data.Response) {
                      $('#claninfo').html('API down?');
                      return;
                   }
                   $.each(data.Response.results, function(index, value) {
                      clan.memberIds.push(value.destinyUserInfo.membershipId);
                      clan.retryCounter[value.destinyUserInfo.membershipId] = 0;
                      clan.memberName[value.destinyUserInfo.membershipId] = value.destinyUserInfo.displayName;
                   });
                    clan.memberCount = clan.memberIds.length;
                    //iterate over every member
                   $.each(clan.memberIds, function(index, memberid) {
                      getAccountData(memberid);
                    });
                 });
          });
           $(document).ajaxStop(function() {
             if (clan.unresolvedMemberNames.length > 0) {
                $('.sk-folding-cube').html('(unable to fetch ' + clan.unresolvedMemberNames.join(', ') + ')');
             } else {
                $('.sk-folding-cube').hide();
             }
           });
           function getAccountData(memberid) {
             //track number of tries for every member
             clan.retryCounter[memberid] = clan.retryCounter[memberid] + 1;
             if (clan.retryCounter[memberid] > 10) {
                //give up on him =/
                clan.unresolvedMemberNames.push(clan.memberName[memberid]);
                return;
             }
              $.ajax({
                url: 'https://www.bungie.net/Platform/Destiny2/2/Account/' + memberid + '/Stats/',
                headers: {
                   'X-API-KEY': bungieAPIkey
                },
                data: {
                   groups: "1,3"
                },
                method: 'GET',
              }).done(function(data) {
                 if (data.ErrorCode > 1 || !data.Response) {
                   getAccountData(memberid); //try again
                } else {
                   clan.membersFetched = clan.membersFetched + 1;
                   $.each(CharStatsDataLocations, function(statName, statLocation) {
                      if (!clan[statName]) clan[statName] = 0;
                      clan[statName] = clan[statName] + getDescendantProp(data, statLocation);
                   });
                    outputClanData(clan);
                }
              });
             return;
          }
           function getDescendantProp(obj, desc) {
             var arr = desc.split('.');
             while (arr.length && (obj = obj[arr.shift()]));
             return obj;
          }
           function convertSeconds(s) {
             var d, h, m;
             m = Math.floor(s / 60);
             s = s % 60;
             h = Math.floor(m / 60);
             m = m % 60;
             d = Math.floor(h / 24);
             h = h % 24;
             return d + ' days, ' + h + ' hours, ' + m + ' minutes'
           }
           function outputClanData(clanobject) {
             $('#pvpKills').html((clanobject.pvpKills).toLocaleString('en'));
             $('#pvpAssists').html((clanobject.pvpAssists).toLocaleString('en'));
             $('#pvpWon').html((clanobject.pvpWon).toLocaleString('en'));
             $('#pvpDeaths').html((clanobject.pvpDeaths).toLocaleString('en'));
             $('#pvpSuicides').html((clanobject.pvpSuicides).toLocaleString('en'));
             $('#pvpKD').html((Math.round(clanobject.pvpKills / clanobject.pvpDeaths * 100) / 100).toLocaleString('en'));
             $('#pvpKDA').html((Math.round((clanobject.pvpKills + clanobject.pvpAssists) / clanobject.pvpDeaths * 100) / 100).toLocaleString('en'));
             $('#pvpCollKD').html((Math.round(clanobject.pvpKD * 100) / 100).toLocaleString('en'));
             $('#pvpSeconds').html(convertSeconds(clanobject.pvpSeconds));
             $('#pvpWROOMs').html((clanobject.pvpWROOMs).toLocaleString('en'));
             $('#pvpUndefeats').html((clanobject.pvpUndefeats).toLocaleString('en'));
             $('#pvpInvincible').html((clanobject.pvpInvincible).toLocaleString('en'));
             $('#pvpComeback').html((clanobject.pvpComeback).toLocaleString('en'));
             $('#pvpDoubles').html((clanobject.pvpDoubles).toLocaleString('en'));
             $('#pvpLightsOut').html((clanobject.pvpLightsOut).toLocaleString('en'));
             $('#pvpAnnihilation').html((clanobject.pvpAnnihilation).toLocaleString('en'));
             $('#pvpRuthless').html((clanobject.pvpRuthless).toLocaleString('en'));
             $('#pvpFightMe').html((clanobject.pvpFightMe).toLocaleString('en'));
             $('#pvpNSFMF').html((clanobject.pvpNSFMF).toLocaleString('en'));
             $('#pveKills').html((clanobject.pveKills).toLocaleString('en'));
             $('#pveDeaths').html((clanobject.pveDeaths).toLocaleString('en'));
             $('#pveSuicides').html((clanobject.pveSuicides).toLocaleString('en'));
             $('#pveOrbs').html((clanobject.pveOrbs).toLocaleString('en'));
             $('#pveAdventures').html((clanobject.pveAdventures).toLocaleString('en'));
             $('#pveHPE').html((clanobject.pveHPE).toLocaleString('en'));
             $('#pveSeconds').html(convertSeconds(clanobject.pveSeconds));
             $('#membercounter').html(clanobject.membersFetched + '/' + clanobject.memberCount);
              return;
          }

   
         function openTab(btn, tabName) {
					 $('.tabcontent').hide();	          
                $('.tablinks').removeClass( "active" );
                $('#' + tabName ).show();
                $('#' + btn).addClass("active");
            }



    </script>
  </head>
  <body>
      

<div class="tab" id="claninfo">
  <button id="tablink1" class="tablinks">Vanguard</button>
  <button id="tablink2" class="tablinks">Crucible</button>
  <button id="tablink3" class="tablinks">PVP Medals</button>
   
    <div class="spinner">
   
      <div class="cubelegend"><span id="membercounter"></span> members</div>
   
      <div class="sk-folding-cube">
        <div class="sk-cube1 sk-cube"></div>
        <div class="sk-cube2 sk-cube"></div>
        <div class="sk-cube4 sk-cube"></div>
        <div class="sk-cube3 sk-cube"></div>
      </div>
    </div>  

</div>

<div id="t1" class="tabcontent">
<div  class="table-responsive-sm">
     <table class="table table-sm">
      <tbody>
        <tr>
          <th scope="row" class="align-middle text-center"><img src="https://www.bungie.net/common/destiny2_content/icons/0e0111755dc85e72c37ca211876859b2.png" width="30" height="30" style="filter: invert(50%);"></th>
          <td class="count-text align-middle">PVE Total Time</td>
          <td id="pveSeconds" class="align-middle text-left"></td>
        </tr>
        <tr>
          <th scope="row" class="align-middle text-center"></th>
          <td class="count-text align-middle">PVE Kills</td>
          <td id="pveKills" class="align-middle text-left"></td>
        </tr>
        <tr>
          <th scope="row" class="align-middle text-center"></th>
          <td class="count-text align-middle">PVE Deaths</td>
          <td id="pveDeaths" class="align-middle text-left"></td>
        </tr>
        <tr>
          <th scope="row" class="align-middle text-center"></th>
          <td class="count-text align-middle">PVE Suicides</td>
          <td id="pveSuicides" class="align-middle text-left"></td>
        </tr>
        <tr>
          <th scope="row" class="align-middle text-center"></th>
          <td class="count-text align-middle">Orbs Created</td>
          <td id="pveOrbs" class="align-middle text-left"></td>
        </tr>
        <tr>
          <th scope="row" class="align-middle text-center"><img src="https://www.bungie.net/common/destiny2_content/icons/2e8dc88df22900c574902b3a565779c6.png" width="30" height="30" style="filter: invert(50%);"></th>
          <td class="count-text align-middle">Adventures Completed</td>
          <td id="pveAdventures" class="align-middle text-left"></td>
        </tr>
        <tr>
          <th scope="row" class="align-middle text-center"><img src="https://www.bungie.net/common/destiny2_content/icons/0fcd2aead5b32536b6110471b3ba2bfb.png" width="30" height="30" style="filter: invert(50%);"></th>
          <td class="count-text align-middle">Heroic Public Events</td>
          <td id="pveHPE" class="align-middle text-left"></td>
        </tr>
        <tr>
          <th scope="row" class="align-middle text-center"></th>
          <td class="count-text align-middle">Highest Nightfall Score</td>
          <td class="align-middle text-left">259,910</td>
        </tr>
      </tbody>
    </table>
  </div>

</div>

<div id="t2" class="tabcontent">
  <div class=" table-responsive-sm">
     <table class="table table-sm">
      <tbody>
        <tr>
          <th scope="row" class="align-middle text-center"><img src="https://www.bungie.net/common/destiny2_content/icons/1c165e33b1c673f192cd778773e775cd.png" width="30" height="30" style="filter: invert(50%);"></th>
          <td class="count-text align-middle">PVP Total Time</td>
          <td  id="pvpSeconds" class="align-middle text-left"></td>
        </tr>
        <tr>
          <th scope="row" class="align-middle text-center"></th>
          <td class="count-text align-middle">PVP Kills</td>
          <td id="pvpKills" class="align-middle text-left"></td>
        </tr>
        <tr>
          <th scope="row" class="align-middle text-center"></th>
          <td class="count-text align-middle">PVP Deaths</td>
          <td id="pvpDeaths" class="align-middle text-left"></td>
        </tr>
        <tr>
          <th scope="row" class="align-middle text-center"></th>
          <td class="count-text align-middle">PVP Suicides</td>
          <td id="pvpSuicides" class="align-middle text-left"></td>
        </tr>
        <tr>
          <th scope="row" class="align-middle text-center"></th>
          <td class="count-text align-middle">PVP Assists</td>
          <td id="pvpAssists" class="align-middle text-left"></td>
        </tr>
        <tr>
          <th scope="row" class="align-middle text-center"></th>
          <td class="count-text align-middle">PVP Games Won</td>
          <td id="pvpWon" class="align-middle text-left"></td>
        </tr>
        <tr>
          <th scope="row" class="align-middle text-center"></th>
          <td class="count-text align-middle">PVP K/D</td>
          <td id="pvpKD" class="align-middle text-left"></td>
        </tr>
         <tr>
          <th scope="row" class="align-middle text-center"></th>
          <td class="count-text align-middle">PVP (K+A)/D</td>
          <td id="pvpKDA" class="align-middle text-left"></td>
        </tr>
        <tr>
          <th scope="row" class="align-middle text-center"></th>
          <td class="count-text align-middle">Total Flawless Runs</td>
          <td class="align-middle text-left">167</td>
        </tr>
      </tbody>
    </table>
   </div>
</div>

<div id="t3" class="tabcontent">
 <div class="table-responsive-sm">
     <table class="table table-sm">
      <tbody>
        <tr>
          <th scope="row" class="align-middle text-center"><img src="https://www.bungie.net/common/destiny2_content/icons/icon_md2de6954efb417d6571bea9202dbadfd.png" width="30" height="30"></th>
          <td class="count-text align-middle">We Ran out of Medals</td>
          <td id="pvpWROOMs" class="align-middle text-left"></td>
        </tr>
        <tr>
          <th scope="row" class="align-middle text-center"><img src="https://www.bungie.net/common/destiny2_content/icons/icon_m3c7546b477f5378b3c605f4be6d45376.png" width="30" height="30"></th>
          <td class="count-text align-middle">Undefeated</td>
          <td id="pvpUndefeats" class="align-middle text-left"></td>
        </tr>
        <tr>
          <th scope="row" class="align-middle text-center"><img src="https://www.bungie.net/common/destiny2_content/icons/icon_mf6bdc19ff454b545dec8e847696f8d57.png" width="30" height="30"></th>
          <td class="count-text align-middle">Invincible</td>
          <td id="pvpInvincible" class="align-middle text-left"></td>
        </tr>
        <tr>
          <th scope="row" class="align-middle text-center"><img src="https://www.bungie.net/common/destiny2_content/icons/icon_m5be2652a5476087266bb9cf3f95e8372.png" width="30" height="30"></th>
          <td class="count-text align-middle">Annihilation</td>
          <td id="pvpAnnihilation" class="align-middle text-left"></td>
        </tr>
        <tr>
          <th scope="row" class="align-middle text-center"><img src="https://www.bungie.net/common/destiny2_content/icons/icon_m5bee79e64764fa4c94d795848d4362e6.png" width="30" height="30"></th>
          <td class="count-text align-middle">Double Play</td>
          <td id="pvpDoubles" class="align-middle text-left"></td>
        </tr>
        <tr>
          <th scope="row" class="align-middle text-center"><img src="https://www.bungie.net/common/destiny2_content/icons/icon_ma60aa3835852cc63462a8539e9543419.png" width="30" height="30"></th>
          <td class="count-text align-middle">Lights Out</td>
          <td id="pvpLightsOut" class="align-middle text-left"></td>
        </tr>
        <tr>
          <th scope="row" class="align-middle text-center"><img src="https://www.bungie.net/common/destiny2_content/icons/icon_mee5acb046145e887d1e7698fa0171603.png" width="30" height="30"></th>
          <td class="count-text align-middle">From the Jaws of Defeat</td>
          <td id="pvpComeback" class="align-middle text-left"></td>
        </tr>
        <tr>
          <th ope="row" class="align-middle text-center"><img src="https://www.bungie.net/common/destiny2_content/icons/icon_mdbab442edbc7e7ecd6a56f5ac1b1dd47.png" width="30" height="30"></th>
          <td class="count-text align-middle">Ruthless</td>
          <td id="pvpRuthless" class="align-middle text-left"></td>
        </tr>
        <tr>
          <th scope="row" class="align-middle text-center"><img src="https://www.bungie.net/common/destiny2_content/icons/icon_me582cbac24c4cecd6f728afc67f882f9.png" width="30" height="30"></th>
          <td class="count-text align-middle">Fight Me!</td>
          <td id="pvpFightMe" class="align-middle text-left"></td>
        </tr>
        <tr>
          <th scope="row" class="align-middle text-center"><img src="https://www.bungie.net/common/destiny2_content/icons/icon_m164efd3b6b3104df99c3b86a6522f68b.png" width="30" height="30"></th>
          <td class="count-text align-middle">Not So Fast, My Friend</td>
          <td id="pvpNSFMF" class="align-middle text-left"></td>
        </tr>
      </tbody>
    </table>
   </div>
</div>

  </body>
</html>
